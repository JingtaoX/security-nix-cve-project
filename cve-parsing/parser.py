from transformers import pipeline
model_name = "deepset/tinyroberta-squad2"
nlp = pipeline('question-answering', model=model_name, tokenizer=model_name)

from dataclasses import dataclass

@dataclass
class Out:
    name: str
    version: list[str]

def get_version(cve):
    question = "What is the affected version number?"
    QA_input = {
        'question': question,
        'context': cve
    }
    res = nlp(QA_input)
    return res['answer']

def get_name(cve):
    question = "What is the name of the software?"
    QA_input = {
        'question': question,
        'context': cve
    }
    res = nlp(QA_input)
    return res['answer']

def parse_cve(cve: str) -> Out:
    name = get_name(cve)
    version = get_version(get_version(cve))
    return Out(name, [version])

if __name__ == "__main__":
    context1 = "Natus NeuroWorks and SleepWorks before 8.4 GMA3 utilize a default password of xltek for the Microsoft SQL Server service sa account, allowing a threat actor to perform remote code execution, data exfiltration, or other nefarious actions such as tampering with data or destroying/disrupting MSSQL services. "
    context2 = 'Adobe Acrobat Reader versions 23.003.20244 (and earlier) and 20.005.30467 (and earlier) are affected by an Information Disclosure vulnerability. An unauthenticated attacker could leverage this vulnerability to obtain NTLMv2 credentials. Exploitation of this issue requires user interaction in that a victim must open a maliciously crafted Microsoft Office file, or visit an attacker controlled web page. '
    context3 = "An issue in Inspect Element Ltd Echo.ac v.5.2.1.0 allows a local attacker to gain privileges via a crafted command to the echo_driver.sys component. NOTE: the vendor's position is that the reported ability for user-mode applications to execute code as NT AUTHORITY\SYSTEM was deactivated by Microsoft itself."
    print(parse_cve(context2))